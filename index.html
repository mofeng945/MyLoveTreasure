<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4a6fa5">
    <meta name="description" content="ä¸€ä¸ªç®€å•æ˜“ç”¨çš„è®°è´¦åº”ç”¨ï¼Œæ”¯æŒç¦»çº¿ä½¿ç”¨å’Œæ•°æ®æœ¬åœ°åŒæ­¥">
    <meta name="format-detection" content="telephone=no">
    <link rel="manifest" href="manifest.json">
    <title>ç®€æ˜“è®°è´¦æœ¬</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>ç®€æ˜“è®°è´¦æœ¬</h1>
        <div class="ledger-selector">
            <span id="current-ledger-name">é»˜è®¤è´¦æœ¬</span>
            <div class="ledger-dropdown">
                <select id="ledger-select"></select>
                <button id="add-ledger-btn" class="add-ledger-btn">+</button>
            </div>
        </div>
    </header>
    <main>
        <!-- é¡¶éƒ¨å¯¼èˆªæ  - æ¡Œé¢ç«¯ -->
        <div class="tabs desktop-tabs">
            <button class="tab-btn active" data-tab="input">è®°è´¦</button>
            <button class="tab-btn" data-tab="calendar">æ—¥å†</button>
            <button class="tab-btn" data-tab="records">è®°å½•</button>
            <button class="tab-btn" data-tab="settings">è®¾ç½®</button>
        </div>
        
        <!-- ç§»åŠ¨ç«¯è¿”å›æŒ‰é’® -->
        <button id="back-button" class="back-button" style="display: none;">â† è¿”å›</button>
        
        <!-- è®°è´¦æ ‡ç­¾é¡µ -->
        <div id="input-tab" class="tab-content active">
            <section class="input-section">
                <div class="input-group">
                    <label for="amount">é‡‘é¢:</label>
                    <input type="number" id="amount" placeholder="è¯·è¾“å…¥é‡‘é¢">
                </div>
                <div class="input-group">
                    <label for="main-category">ä¸€çº§åˆ†ç±»:</label>
                    <select id="main-category">
                        <!-- åˆ†ç±»ä¼šæ ¹æ®æ”¶æ”¯ç±»å‹åŠ¨æ€å¡«å…… -->
                    </select>
                </div>
                <div class="input-group">
                    <label for="sub-category">äºŒçº§åˆ†ç±»:</label>
                    <select id="sub-category">
                        <option value="">è¯·å…ˆé€‰æ‹©ä¸€çº§åˆ†ç±»</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="date">æ—¥æœŸ:</label>
                    <input type="date" id="date">
                </div>
                <div class="input-group">
                    <label for="description">å¤‡æ³¨:</label>
                    <div class="description-container">
                        <textarea id="description" placeholder="æ·»åŠ å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰" rows="3"></textarea>
                        <button id="add-image" class="add-image-btn">æ’å…¥å›¾ç‰‡</button>
                    </div>
                    <div id="image-preview" class="image-preview"></div>
                </div>
                <div class="input-group">
                    <label for="type">ç±»å‹:</label>
                    <div class="type-buttons">
                        <button id="expense" class="type-btn active">æ”¯å‡º</button>
                        <button id="income" class="type-btn">æ”¶å…¥</button>
                    </div>
                </div>
                <button id="add-record">æ·»åŠ è®°å½•</button>
            </section>
            
            <section class="summary-section">
                <div class="summary-card">
                    <h3>æ€»æ”¶å…¥</h3>
                    <p id="total-income">Â¥0.00</p>
                </div>
                <div class="summary-card">
                    <h3>æ€»æ”¯å‡º</h3>
                    <p id="total-expense">Â¥0.00</p>
                </div>
                <div class="summary-card">
                    <h3>ç»“ä½™</h3>
                    <p id="balance">Â¥0.00</p>
                </div>
            </section>
        </div>
        
        <!-- æ—¥å†æ ‡ç­¾é¡µ -->
        <div id="calendar-tab" class="tab-content">
            <section class="calendar-section">
                <div class="calendar-header">
                    <button id="prev-month">â†</button>
                    <h2 id="current-month"></h2>
                    <button id="next-month">â†’</button>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-weekdays">
                        <div>æ—¥</div>
                        <div>ä¸€</div>
                        <div>äºŒ</div>
                        <div>ä¸‰</div>
                        <div>å››</div>
                        <div>äº”</div>
                        <div>å…­</div>
                    </div>
                    <div id="calendar-days" class="calendar-days"></div>
                </div>
                <div id="calendar-records" class="calendar-records">
                    <h3>å½“æ—¥è®°å½•</h3>
                    <div id="selected-day-records"></div>
                </div>
            </section>
        </div>
        
        <!-- è®°å½•æ ‡ç­¾é¡µ -->
        <div id="records-tab" class="tab-content">
            <section class="records-section">
                <h2>æ”¶æ”¯è®°å½•</h2>
                <div class="filter-section">
                    <div class="input-group">
                        <label for="filter-type">ç±»å‹:</label>
                        <select id="filter-type">
                            <option value="all">å…¨éƒ¨</option>
                            <option value="expense">æ”¯å‡º</option>
                            <option value="income">æ”¶å…¥</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="filter-main-category">ä¸€çº§åˆ†ç±»:</label>
                        <select id="filter-main-category">
                            <option value="all">å…¨éƒ¨</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="filter-sub-category">äºŒçº§åˆ†ç±»:</label>
                        <select id="filter-sub-category">
                            <option value="all">å…¨éƒ¨</option>
                        </select>
                    </div>
                    <button id="clear-filter" class="clear-filter-btn">æ¸…ç©ºç­›é€‰</button>
                </div>
                <div id="records-list"></div>
            </section>
        </div>
        
        <!-- è®¾ç½®æ ‡ç­¾é¡µ -->
        <div id="settings-tab" class="tab-content">
            <section class="settings-section">
                <h2>ä¸ªæ€§åŒ–è®¾ç½®</h2>
                
                <!-- ä¸»é¢˜è‰²è®¾ç½® -->
                <div class="setting-group">
                    <h3>ä¸»é¢˜è‰²</h3>
                    <div class="theme-colors">
                        <button class="color-option" data-color="#4a6fa5" style="background-color: #4a6fa5;"></button>
                        <button class="color-option" data-color="#2196f3" style="background-color: #2196f3;"></button>
                        <button class="color-option" data-color="#4caf50" style="background-color: #4caf50;"></button>
                        <button class="color-option" data-color="#ff9800" style="background-color: #ff9800;"></button>
                        <button class="color-option" data-color="#f44336" style="background-color: #f44336;"></button>
                        <button class="color-option" data-color="#9c27b0" style="background-color: #9c27b0;"></button>
                    </div>
                    <div class="input-group">
                        <label for="custom-color">è‡ªå®šä¹‰é¢œè‰²:</label>
                        <input type="color" id="custom-color" value="#4a6fa5">
                    </div>
                </div>
                
                <!-- èƒŒæ™¯è®¾ç½® -->
                <div class="setting-group">
                    <h3>èƒŒæ™¯è®¾ç½®</h3>
                    <div class="input-group">
                        <label for="bg-type">èƒŒæ™¯ç±»å‹:</label>
                        <select id="bg-type">
                            <option value="color">çº¯è‰²èƒŒæ™¯</option>
                            <option value="image">å›¾ç‰‡èƒŒæ™¯</option>
                        </select>
                    </div>
                    <div id="bg-color-group" class="input-group">
                        <label for="bg-color">èƒŒæ™¯é¢œè‰²:</label>
                        <input type="color" id="bg-color" value="#f5f5f5">
                    </div>
                    <div id="bg-image-group" class="input-group" style="display: none;">
                        <label for="bg-image">ä¸Šä¼ èƒŒæ™¯å›¾ç‰‡:</label>
                        <input type="file" id="bg-image" accept="image/*">
                        <button id="remove-bg-image" class="remove-bg-btn">ç§»é™¤èƒŒæ™¯å›¾ç‰‡</button>
                    </div>
                </div>
                
                <!-- æŒ‰é’®æ ·å¼è®¾ç½® -->
                <div class="setting-group">
                    <h3>æŒ‰é’®æ ·å¼</h3>
                    <div class="button-styles">
                        <label class="style-option">
                            <input type="radio" name="button-style" value="default" checked>
                            <span>é»˜è®¤æ ·å¼</span>
                        </label>
                        <label class="style-option">
                            <input type="radio" name="button-style" value="rounded">
                            <span>åœ†è§’æ ·å¼</span>
                        </label>
                        <label class="style-option">
                            <input type="radio" name="button-style" value="shadow">
                            <span>é˜´å½±æ ·å¼</span>
                        </label>
                        <label class="style-option">
                            <input type="radio" name="button-style" value="flat">
                            <span>æ‰å¹³æ ·å¼</span>
                        </label>
                    </div>
                </div>
                
                <!-- è´¦æœ¬ç®¡ç† -->
                <div class="setting-group">
                    <h3>è´¦æœ¬ç®¡ç†</h3>
                    <div class="ledger-management">
                        <div class="input-group">
                            <label for="new-ledger-name">æ–°å»ºè´¦æœ¬:</label>
                            <input type="text" id="new-ledger-name" placeholder="è¯·è¾“å…¥è´¦æœ¬åç§°">
                            <button id="create-ledger-btn" class="create-ledger-btn">åˆ›å»º</button>
                        </div>
                        <div id="ledgers-list" class="ledgers-list">
                            <!-- è´¦æœ¬åˆ—è¡¨ä¼šåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
                
                <button id="reset-settings" class="reset-settings-btn">é‡ç½®ä¸ºé»˜è®¤è®¾ç½®</button>
            </section>
        </div>
    </main>
    
    <!-- ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆªæ  -->
    <div class="mobile-bottom-nav">
        <button class="mobile-tab-btn active" data-tab="input">
            <span class="nav-icon">ğŸ’°</span>
            <span>è®°è´¦</span>
        </button>
        <button class="mobile-tab-btn" data-tab="calendar">
            <span class="nav-icon">ğŸ“…</span>
            <span>æ—¥å†</span>
        </button>
        <button class="mobile-tab-btn" data-tab="records">
            <span class="nav-icon">ğŸ“‹</span>
            <span>è®°å½•</span>
        </button>
        <button class="mobile-tab-btn" data-tab="settings">
            <span class="nav-icon">âš™ï¸</span>
            <span>è®¾ç½®</span>
        </button>
    </div>
    
    <footer class="desktop-footer">
        <p>ç®€æ˜“è®°è´¦æœ¬ &copy; 2023</p>
    </footer>
    
    <script src="app.js"></script>
    <script>
        // æ³¨å†ŒService Workerä»¥æ”¯æŒç¦»çº¿åŠŸèƒ½
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker æ³¨å†ŒæˆåŠŸ:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker æ³¨å†Œå¤±è´¥:', error);
                    });
            });
        }
        
        // ç§»åŠ¨ç«¯ä¼˜åŒ–ä»£ç 
        document.addEventListener('DOMContentLoaded', function() {
            // å¤„ç†çª—å£å¤§å°å˜åŒ–ï¼Œåˆ‡æ¢å¯¼èˆªæ ·å¼
            function handleResize() {
                const isMobile = window.innerWidth < 768;
                const desktopTabs = document.querySelector('.desktop-tabs');
                const mobileNav = document.querySelector('.mobile-bottom-nav');
                const backButton = document.getElementById('back-button');
                const footer = document.querySelector('.desktop-footer');
                
                if (isMobile) {
                    if (desktopTabs) desktopTabs.style.display = 'none';
                    if (mobileNav) mobileNav.style.display = 'flex';
                    if (backButton) backButton.style.display = 'block';
                    if (footer) footer.style.display = 'none';
                } else {
                    if (desktopTabs) desktopTabs.style.display = 'flex';
                    if (mobileNav) mobileNav.style.display = 'none';
                    if (backButton) backButton.style.display = 'none';
                    if (footer) footer.style.display = 'block';
                }
            }
            
            // åˆå§‹åŒ–è°ƒç”¨ä¸€æ¬¡
            handleResize();
            
            // ç›‘å¬çª—å£å¤§å°å˜åŒ–
            window.addEventListener('resize', handleResize);
            
            // è¿”å›æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            const backButton = document.getElementById('back-button');
            if (backButton) {
                backButton.addEventListener('click', function() {
                    // åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šè¿”å›ä¸Šä¸€ä¸ªæ“ä½œæˆ–é¡µé¢
                    if (window.history.length > 1) {
                        window.history.back();
                    } else {
                        // å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œå¯ä»¥åˆ‡æ¢åˆ°é»˜è®¤æ ‡ç­¾é¡µ
                        const defaultTab = document.querySelector('.mobile-tab-btn[data-tab="input"]');
                        if (defaultTab) {
                            defaultTab.click();
                        }
                    }
                });
            }
            
            // ç§»åŠ¨ç«¯æ ‡ç­¾é¡µç‚¹å‡»äº‹ä»¶
            const mobileTabButtons = document.querySelectorAll('.mobile-tab-btn');
            mobileTabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // ç§»é™¤æ‰€æœ‰æ¿€æ´»çŠ¶æ€
                    mobileTabButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // æ·»åŠ å½“å‰æ¿€æ´»çŠ¶æ€
                    this.classList.add('active');
                    
                    // è§¦å‘å¯¹åº”æ¡Œé¢ç«¯æ ‡ç­¾é¡µçš„ç‚¹å‡»äº‹ä»¶
                    const desktopTab = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
                    if (desktopTab) {
                        desktopTab.click();
                    }
                });
            });
            
            // ä¼˜åŒ–ç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶ï¼Œå‡å°‘å»¶è¿Ÿ
            document.addEventListener('touchstart', function() {}, {passive: true});
            
            // ç¦æ­¢iOSä¸Šçš„åŒå‡»ç¼©æ”¾
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        });
    </script>
</body>
</html>